spec_version: 2
description: Deployes a vm from a template on a vcenter

inputs:
  host_name:
    type: execution-host
    description: "execution host name"

  virtual_machine_template_name:
    display-style: normal
    type: string
    default: gilad.m/gmpWithSnapshot
    description: vm template name

  virtual_machine_name:
    display-style: normal
    type: string
    default: snapshot
    description: deployed vm name

  network_name:
    display-style: normal
    type: string
    default: Anetwork
    description: target network name

outputs:
  virtual_machine_name:
    value: "{{ .grains.virtual_machine.outputs.vsphere_virtual_machine_name }}"

  virtual_machine_ip:
    value: "{{ .grains.virtual_machine.outputs.vsphere_virtual_machine_default_ip_address }}"

grains:
  virtual_machine:
    kind: terraform
    spec:
      inputs:
        - virtual_machine_template_name: "{{ .inputs.virtual_machine_template_name }}"
        - virtual_machine_name: "{{ .inputs.virtual_machine_name }}"
        - network_name: "{{ .inputs.network_name }}"
        - vc_address: "{{ .params.vc_address }}"
        - vc_username: "{{ .params.vc_username }}"
        - vc_password: "{{ .params.vc_password }}"
      outputs:
        - vsphere_virtual_machine_name
        - vsphere_virtual_machine_default_ip_address
      source:
        store: qa_automation
        path: assets/terraform/vm-from-template-wait-for-ip
      host:
        name: "{{.inputs.host_name}}"
